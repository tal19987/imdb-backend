pipeline {
    agent {
        dockerfile {
            dir 'server'
        }
    }
    environment {
        customImg = ""
    }
    stages {
        stage ("docker") {
            steps {
                script {
                    customImg = docker.build("tal19987/imdb:python-${env.BUILD_ID}", "-f server/Dockerfile")
                    customImg.push()
                }
            }
        }
    }
    post {
        always {
            sh "docker rm -f ${customImg.id}"
        }
    }
}