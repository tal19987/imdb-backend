pipeline {
    agent any
    environment {
        customImg = ""
        registry = "tal19987/imdb"
        registryCredential = "dockerhub-account"
    }
    stages {
        stage ("Build Docker Image") {
            steps {
                script {
                    customImg = docker.build("tal19987/imdb:python-${env.BUILD_ID}", "-f ./server/Dockerfile server/")
                    docker.withRegistry('',registryCredential) {
                        customImg.push()
                    }
                }
            }
        }
    }
    post {
        always {
            sh "docker rmi -f ${customImg.id}"
        }
    }
}